<!DOCTYPE html>
<html lang="jp">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GCU - Gvolta Output Current Calculator V_1.25</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; }
    h2 { background-color: #e9d0e4; padding: 10px; text-align: center; }
    .lang-buttons { text-align: center; margin-bottom: 15px; }
    .lang-buttons button { margin: 0 10px; padding: 8px 15px; cursor: pointer; }
    fieldset { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; background: #fff; }
    legend { font-weight: bold; }
    .button-group button { margin: 5px; padding: 10px 15px; }
    .button-group input { width: 100px; margin-top: 10px; display: block; }
    .button-group button.active { background-color: #c8f7c5; border: 2px solid green; }
    .output { font-size: 1.2em; background: #e5f9e7; padding: 10px; width: fit-content; margin: 20px auto 10px auto; text-align: center; }
    .note { font-size: 0.9em; color: #666; display: block; margin-top: 5px; }
    .reference { background-color: #fff8d2; padding: 10px; margin-top: 30px; border: 1px solid #ddd; }
    #calcBtn { display: block; margin: 20px auto; font-size: 2em; padding: 25px 50px; }
  </style>
</head>
<body>
  <!-- Title and Language Toggle -->
  <h2 id="pageTitle">GCU - Gvolta 出力電流計算機</h2>
  <div class="lang-buttons">
    <button onclick="switchLang('en')">EN</button>
    <button onclick="switchLang('jp')">日本語</button>
  </div>

  <!-- Charger Selection -->
  <fieldset>
    <legend data-i18n="chargerCategory">GC充電器カテゴリを選択してください</legend>
    <div class="button-group" id="chargerButtons">
      <button onclick="selectCharger(this, 21, 0.81)">21 kW</button>
      <button onclick="selectCharger(this, 13, 0.79)">13 kW</button>
      <button onclick="selectCharger(this, 10, 0.78)">10 kW</button>
      <button onclick="selectCharger(this, 'custom')" data-i18n="custom">カスタム</button>
      <input type="number" id="customKW" placeholder="xx kW" step="0.1" style="display:none;">
      <input type="number" id="customEff" placeholder="Efficiency (%)" step="0.01" style="display:none;">
    </div>
    <span class="note" data-i18n="chargerNote">注: 1〜500 kW の値を入力可能</span>
  </fieldset>

  <!-- Voltage Selection -->
  <fieldset>
    <legend data-i18n="voltageCategory">電源電圧カテゴリを選択してください (3相)</legend>
    <div class="button-group" id="voltageButtons">
      <button onclick="selectVoltage(this, 200)">200 V</button>
      <button onclick="selectVoltage(this, 400)">400 V</button>
      <button onclick="selectVoltage(this, 'custom')" data-i18n="custom">カスタム</button>
      <input type="number" id="customVolt" placeholder="xx V" step="0.1" style="display:none;">
    </div>
    <span class="note" data-i18n="voltageNote">注: 100〜1500 V の値を入力可能</span>
  </fieldset>

  <!-- Breaker Selection -->
  <fieldset>
    <legend data-i18n="breakerRating">3相ブレーカ定格を入力してください (A単位)</legend>
    <div class="button-group" id="currentButtons">
      <button onclick="selectCurrent(this, 20)">20 A</button>
      <button onclick="selectCurrent(this, 30)">30 A</button>
      <button onclick="selectCurrent(this, 50)">50 A</button>
      <button onclick="selectCurrent(this, 'custom')" data-i18n="custom">カスタム</button>
      <input type="number" id="customAmp" placeholder="xx A" step="0.1" style="display:none;">
    </div>
    <span class="note" data-i18n="currentNote">注: 1.0〜200.0 A の値を入力可能</span>
  </fieldset>

  <!-- Calculate Button -->
  <button onclick="calculateOutput()" id="calcBtn">出力電流を計算</button>

  <!-- Output Results -->
  <div class="output" id="result"></div>
  <div class="reference" id="calculationReference"></div>

  <!-- JavaScript for interactivity and translation -->
  <script>
    let chargerKW = null;
    let chargerEff = null;
    let voltage = null;
    let current = null;

    // Default language set to Japanese
    document.addEventListener("DOMContentLoaded", () => switchLang('jp'));

    function switchLang(lang) {
      const textMap = {
        'pageTitle': { en: "GCU - Gvolta Output Current Calculator", jp: "GCU - Gvolta 出力電流計算機" },
        'chargerCategory': { en: "Choose your GC charger category", jp: "GC充電器カテゴリを選択してください" },
        'custom': { en: "Custom", jp: "カスタム" },
        'chargerNote': { en: "Note: Accepts values from 1 to 500 kW", jp: "注: 1〜500 kW の値を入力可能" },
        'voltageCategory': { en: "Choose the Power supply voltage category (3 phase)", jp: "電源電圧カテゴリを選択してください (3相)" },
        'voltageNote': { en: "Note: Accepts values from 100 to 1500 V", jp: "注: 100〜1500 V の値を入力可能" },
        'breakerRating': { en: "Enter the 3-phase breaker rating (In Amps)", jp: "3相ブレーカ定格を入力してください (A単位)" },
        'currentNote': { en: "Note: Accepts values from 1.0 to 200.0 A", jp: "注: 1.0〜200.0 A の値を入力可能" },
        'calcBtn': { en: "Calculate Output Current", jp: "出力電流を計算" },
      };
      for (const key in textMap) {
        const el = document.querySelector(`[data-i18n="${key}"]`);
        if (el) el.textContent = textMap[key][lang];
      }
      document.getElementById("pageTitle").textContent = textMap['pageTitle'][lang];
      document.getElementById("calcBtn").textContent = textMap['calcBtn'][lang];
    }

    function selectCharger(el, value, eff = null) {
      clearActive("chargerButtons");
      el.classList.add("active");
      chargerKW = value;
      if (value === 'custom') {
        document.getElementById("customKW").style.display = 'inline-block';
        document.getElementById("customEff").style.display = 'inline-block';
      } else {
        chargerEff = eff;
        document.getElementById("customKW").style.display = 'none';
        document.getElementById("customEff").style.display = 'none';
      }
    }

    function selectVoltage(el, val) {
      clearActive("voltageButtons");
      el.classList.add("active");
      voltage = val;
      document.getElementById("customVolt").style.display = (val === 'custom') ? 'inline-block' : 'none';
    }

    function selectCurrent(el, val) {
      clearActive("currentButtons");
      el.classList.add("active");
      current = val;
      document.getElementById("customAmp").style.display = (val === 'custom') ? 'inline-block' : 'none';
    }

    function clearActive(groupId) {
      const btns = document.getElementById(groupId).getElementsByTagName("button");
      for (let b of btns) b.classList.remove("active");
    }

    function calculateOutput() {
      let kw = (chargerKW === 'custom') ? parseFloat(document.getElementById("customKW").value) : chargerKW;
      let eff = (chargerKW === 'custom') ? parseFloat(document.getElementById("customEff").value) / 100 : chargerEff;
      let volt = (voltage === 'custom') ? parseFloat(document.getElementById("customVolt").value) : voltage;
      let curr = (current === 'custom') ? parseFloat(document.getElementById("customAmp").value) : current;

      if (!kw || !eff || !volt || !curr || kw <= 0 || eff <= 0 || volt <= 0 || curr <= 0) {
        document.getElementById("result").innerText = "全ての値を正しく入力してください。";
        return;
      }

      const powerFactor = 0.8;
      let inputPower = Math.sqrt(3) * volt * curr * powerFactor;
      let outputPower = inputPower * eff;
      let outputCurrent = outputPower / 66;

      document.getElementById("result").innerText = `66Vでの推定GC出力電流: ${outputCurrent.toFixed(2)} Amps`;

      document.getElementById("calculationReference").innerHTML = `
        <strong>計算参照:</strong><br>
        入力電力 = √3 × ${volt} × ${curr} × ${powerFactor} = ${inputPower.toFixed(2)} W<br>
        出力電力 = 入力電力 × 効率 (${(eff * 100).toFixed(1)}%) = ${outputPower.toFixed(2)} W<br>
        出力電流 = 出力電力 / 66 = ${outputCurrent.toFixed(2)} A
      `;
    }
  </script>
</body>
</html>

